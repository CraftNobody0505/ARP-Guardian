# Windows 局域网 ARP 安全监控系统 (ARP 守护者)

![语言](https://img.shields.io/badge/language-Python-blue.svg)
![许可证](https://img.shields.io/badge/license-MIT-green.svg)
![Uploading 0_3.png…]()

**项目描述:**
ARP 守护者是一款基于 Python 的 Windows GUI 工具，专为监控局域网 (LAN) 中的 ARP 欺骗攻击而设计。它提供实时检测功能，显示网络设备信息，允许管理静态 ARP 绑定，并提供主动防御机制以缓解持续的 ARP 威胁。

## 主要功能

*   **管理员权限自动提升**：启动时检测并尝试获取管理员权限，以确保所有核心功能可以正常运行。
*   **网络接口选择**：允许用户从可用列表中选择要进行监控的网络接口。
*   **本机与网关信息显示**：清晰展示当前选定接口的本机 IP 地址、MAC 地址以及自动探测到的网络网关 IP 和 MAC 地址。
*   **ARP 嗅探与设备发现**：
    *   利用强大的 Scapy 库实时捕获和分析局域网内的 ARP 数据包。
    *   动态地将通过 ARP 包观察到的网络中的活动设备展示出来，包括其 IP 地址、MAC 地址、在线状态以及最后活跃的时间戳。
*   **ARP 欺骗检测**：
    *   通过将观察到的 MAC 地址与以下一个或多个可信来源进行比较，来识别潜在的 ARP 欺骗行为：
        *   用户定义的静态 ARP 绑定条目。
        *   当前系统的 ARP 缓存表。
        *   针对特定 IP 地址历史上观察到的 MAC 地址。
    *   当检测到 IP 地址对应的 MAC 地址发生可疑变化时，会在“安全警报”标签页中生成详细警报。
*   **ARP 静态绑定管理**：
    *   用户可以方便地手动添加新的 IP-MAC 静态绑定条目（通过系统 `arp -s` 命令实现）。
    *   用户可以从列表中选择并删除已存在的静态 ARP 条目（通过系统 `arp -d` 命令实现）。
    *   提供一键绑定当前网关的功能，简化对网关的保护。
    *   能够从系统中加载现有的静态 ARP 条目，并在界面列表中显示。
*   **主动 ARP 防御 (可选功能)**：
    *   当用户启用此功能并且系统检测到 ARP 欺骗攻击时，程序会自动发送纠正性的 ARP 数据包（包括免费 ARP 和针对受害者的定向 ARP），尝试恢复被错误信息污染的主机的 ARP 缓存。
*   **日志记录与界面反馈**：
    *   将所有关键操作、检测到的安全警报以及可能发生的错误信息详细记录到本地的 `arp_monitor.log` 文件中，便于后续分析和故障排查。
    *   图形用户界面 (GUI) 上提供专门的“防御日志”区域，实时显示程序的操作和防御行为。
    *   “安全警报”标签页集中展示所有检测到的威胁事件。
*   **图形用户界面 (GUI)**：
    *   使用 Python 内置的 Tkinter 库构建，提供了一个用户友好且直观的操作界面。
    *   采用多标签页设计，将不同功能模块（控制面板、网络监控、ARP 防御、安全警报）清晰地组织起来，方便用户操作。

## 技术栈

*   **Python 3.x**: 项目的主要编程语言。
*   **Tkinter**: 用于构建跨平台的图形用户界面。
*   **Scapy**: 强大的 Python 库，用于数据包的捕获、分析、伪造和发送。是 ARP 嗅探和主动防御的核心。
*   **WMI (Windows Management Instrumentation)**: Python 通过 `wmi` 库与 Windows WMI 服务交互，以获取详细的网络接口信息（如描述、IP 地址、MAC 地址等）。
*   **ctypes**: Python 的外部函数库，用于调用 Windows 操作系统的 API 函数（例如，检查当前用户是否为管理员以及执行 UAC 提权操作）。
*   **subprocess**: 用于在 Python 程序中执行外部系统命令（例如 `arp -a`, `route print` 等，以获取或修改系统 ARP 表）。

## 安装与运行

### 环境依赖

在运行此程序之前，请确保您的 Python 环境中已安装以下必要的库：

```bash
pip install scapy wmi pypiwin32
```

*   `scapy`: 网络数据包处理的核心库。
*   `wmi`: 用于访问 Windows WMI 服务的接口库。
*   `pypiwin32`: `wmi` 库的一个重要依赖，提供了对 Windows API 的底层访问能力。

**重要提示：**
*   **WinPcap/Npcap 驱动**: Scapy 在 Windows 平台上进行有效的网络嗅探，需要依赖于 WinPcap 或 Npcap 网络数据包捕获驱动程序。请务必预先安装其中之一。强烈推荐安装较新的 **Npcap**，并在其安装过程中勾选 **"WinPcap API-compatible mode"** 选项以获得最佳兼容性。
*   **管理员权限**: 本程序的大部分核心功能（包括但不限于网络嗅探、设置静态 ARP 条目、发送 ARP 包等）都必须在管理员权限下才能正确运行。程序在启动时会尝试自动请求 UAC (用户账户控制) 提权。如果提权请求被拒绝或失败，程序的功能将受到严重限制。

### 运行步骤

1.  **获取项目文件**:
    通过 `git clone` 克隆本项目仓库，或者直接下载项目的 ZIP 压缩包并解压到您的本地计算机。
    ```bash
    git clone https://github.com/your-username/your-repository-name.git
    cd your-repository-name
    ```
    (请将 `your-username/your-repository-name` 替换为实际的仓库地址)

2.  **安装依赖与驱动**:
    确认已按照上一节的说明安装了所有必需的 Python 库以及 WinPcap/Npcap 驱动。

3.  **执行主程序**:
    打开命令行终端 (如 CMD 或 PowerShell)，导航到项目所在的目录，然后使用 Python 解释器运行主程序脚本 (文件名可能是 `arp2.py`, `main.py` 或您指定的其他名称)：
    ```bash
    python main.py
    ```
    (如果您的主脚本文件名不同，请相应修改命令)
    程序启动时，Windows 系统会弹出 UAC 提权请求对话框，请务必选择“是”以授予管理员权限。

## 使用说明

1.  **控制面板 (Dashboard)**:
    *   **选择网络接口**: 这是首要步骤。从下拉列表中选择您当前连接到局域网并且希望进行监控的活动网络接口。选定后，程序会自动尝试获取并显示该接口的本机 IP/MAC 地址以及探测到的网关信息。
    *   **启动/停止监控**: 点击“启动监控”按钮开始对选定接口进行 ARP 数据包的嗅探和分析。再次点击（此时按钮文本变为“停止监控”）则停止。
    *   **启用/禁用ARP防御**: 切换主动 ARP 防御功能的状态。启用后，当程序检测到 ARP 欺骗行为时，会尝试自动发送纠正性的 ARP 数据包。
    *   **刷新接口**: 如果您的网络接口状态发生变化（例如，启用/禁用了某个网卡），可以点击此按钮重新加载和显示可用的网络接口列表。
    *   **系统状态**: 此区域会实时显示当前的监控运行状态、ARP 防御的启用状态、已处理的 ARP 数据包数量，以及 Scapy 库是否可用等关键信息。

2.  **网络监控 (Network Monitor)**:
    *   **网络设备列表**: 此列表会动态更新，展示通过嗅探到的 ARP 数据包所发现的局域网内的活动设备。每个条目通常包含设备的 IP 地址、最后观察到的 MAC 地址、当前状态（如“在线”、“离线”）以及最后一次活跃的时间。
    *   **流量统计**: (当前版本此功能为模拟数据展示) 未来可以扩展为显示通过捕获的数据包计算得到的真实设备流量信息。

3.  **ARP防御 (ARP Defense)**:
    *   **ARP绑定设置**: 在此区域，您可以手动输入一个 IP 地址和其对应的 MAC 地址，然后点击“添加/更新绑定”按钮。程序会尝试将此 IP-MAC 对设置为操作系统的静态 ARP 条目，从而固定该 IP 地址的 MAC 解析结果，增强其防欺骗能力。
    *   **当前ARP绑定**: 此列表显示了当前已通过本程序或系统命令 (`arp -s`) 设置的静态 ARP 条目。您可以选中列表中的条目，并通过右键菜单（如果已实现）或特定按钮来删除选定的静态绑定。
    *   **绑定网关**: 一个便捷功能。点击此按钮，程序会自动将“控制面板”中当前探测到的网关 IP 地址和 MAC 地址设置为一条静态 ARP 绑定。
    *   **加载系统静态绑定**: 点击此按钮，程序会尝试从操作系统读取（通常通过解析 `arp -a` 命令的输出）所有现存的静态 ARP 条目，并将它们显示在“当前ARP绑定”列表中。
    *   **防御日志**: 此文本区域会记录程序执行的与防御相关的操作日志，例如启动/停止监控、启用/禁用防御功能、发送纠正性 ARP 包的动作、静态绑定的添加或删除等。

4.  **安全警报 (Security Alerts)**:
    *   **警报列表**: 当程序根据其检测逻辑判断发生了 ARP 欺骗或其他可疑的网络安全事件时，相关的警报信息会在此列表中显示。每条警报通常包含事件发生的时间、警报类型（如“ARP欺骗”）、可疑行为的来源 IP 地址以及对事件的详细描述。
    *   **清除所有警报**: 点击此按钮可以清空“警报列表”中当前显示的所有警报信息。
    *   **警报详情**: 当您在“警报列表”中选中某一条警报时，下方的文本区域会显示该条警报更完整、更详细的内容。

## 注意事项与已知限制

*   **管理员权限是核心前提**：没有管理员权限，程序的核心功能（如网络嗅探、修改系统 ARP 表等）将无法正常工作或直接失败。
*   **Npcap/WinPcap 驱动依赖**：请务必确保您的 Windows 系统上正确安装并运行了 Npcap 或 WinPcap 网络捕获驱动。否则，Scapy 将无法进行底层的数据包嗅探。
*   **虚拟环境兼容性问题**：如果您从 Python 虚拟环境 (如 venv, conda env) 中运行此脚本，UAC 提权过程可能会导致新生成的管理员权限进程无法正确访问该虚拟环境中的库。为避免此问题，建议将所需的依赖库（Scapy, WMI, PyWin32）安装到系统的全局 Python 环境中，或者研究并采用更复杂的提权后在新进程中重新激活虚拟环境的方案。
*   **性能考量**：在流量非常巨大或网络极为繁忙的环境中，纯 Python 实现的 Scapy 嗅探和数据包处理可能会遇到性能瓶颈，导致丢包或响应延迟。
*   **误报可能性**：ARP 欺骗检测算法并非绝对完美，在某些特殊的网络配置、设备行为或网络事件（例如，某些设备合法地更换了网卡导致 MAC 地址改变，或者网络中存在合法的代理 ARP 服务等情况）下，程序有可能产生误报。用户需要结合实际网络情况进行判断。
*   **防御机制的有效性**：主动 ARP 防御功能可以在一定程度上缓解 ARP 欺骗攻击的影响，但对于持续的、高频率的、精心策划的攻击，其效果可能会受到限制。它的防御效果主要依赖于比攻击者更快、更频繁地向网络广播或向目标主机发送正确的 ARP 信息。
*   **平台特定性 (Windows)**：当前版本的程序主要针对 Windows 操作系统进行设计和测试。在其他操作系统上可能无法直接运行或功能不完整。
*   **流量统计功能为模拟**：请注意，当前版本“网络监控”标签页中的“流量统计”功能是基于随机数生成的模拟数据，并非真实捕获和统计的网络流量。

## 未来可能的改进方向

*   [ ] 实现基于捕获数据包的真实、精确的网络流量统计功能。
*   [ ] 扩展检测能力，增加对其他常见局域网攻击类型的检测 (例如 DHCP 欺骗、DNS 欺骗等)。
*   [ ] 对数据包处理和分析逻辑进行性能优化，以减少在高负载网络环境下的资源占用。
*   [ ] 允许用户自定义警报的触发阈值、配置忽略列表或白名单，以减少特定环境下的误报。
*   [ ] 增加更详细的网络设备信息查询功能 (例如，通过 MAC 地址前缀识别设备制造商)。
*   [ ] 实现用户配置（如静态绑定列表、界面设置）和警报历史的导出与导入功能。
*   [ ] 提供国际化支持，使程序界面能够适应多种语言环境。
*   [ ] 编写更完善的单元测试和集成测试用例，以提高代码质量和程序的稳定性。

## 如何贡献

我们非常欢迎并感谢您对本项目的任何形式的贡献！如果您有好的建议、发现了程序中的 bug，或者希望帮助添加新的功能，请随时通过以下步骤参与进来：

1.  **Fork 本仓库** 到您自己的 GitHub 账户下。
2.  从 `main` (或 `master`) 分支创建一个新的特性分支 (Feature Branch) (`git checkout -b feature/YourAmazingFeature`)。
3.  在您的特性分支上进行代码修改和功能开发。
4.  提交您的更改 (`git commit -m 'Add some AmazingFeature'`)。
5.  将您的特性分支推送到您 Fork 的远程仓库 (`git push origin feature/YourAmazingFeature`)。
6.  在 GitHub 上向本项目的原始仓库发起一个 Pull Request，详细说明您的更改内容和原因。

## 许可证

本项目基于 [MIT 许可证](LICENSE.txt) 进行授权。详细的许可条款请参阅项目根目录下的 `LICENSE.txt` 文件。

## 免责声明

本工具的设计初衷仅限于学习、技术研究以及在获得明确授权的前提下进行合法的网络安全测试和评估。使用者必须严格遵守当地法律法规，并确保其使用行为发生在自己拥有合法授权的网络环境中。任何因非法使用或滥用本工具所导致的一切法律责任和后果，均由使用者本人自行承担，与本项目的作者和贡献者无关。
```
